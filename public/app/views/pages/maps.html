<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
      body {
        margin: 0;
        padding: 0;
        font: 12px sans-serif;
      }
      h1, p {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>

    <div id="map_div" style="height: 590px;"></div>


<script type="text/javascript">

/*setTimeout(function() {
    console.log('setTimeout');
    function initialize() {
  var map;
  console.log(typeof(localStorage.getItem('adlat')) + ' ' + typeof(localStorage.getItem('adlng')));
  var myLatLng = {lat: Number(localStorage.getItem('adlat')), lng: Number(localStorage.getItem('adlng'))};
    map = new google.maps.Map(document.getElementById('map'), {
      center: myLatLng ,
      zoom: 4
    });

    var marker = new google.maps.Marker({
      position: myLatLng,
      map: map,
      title: 'Hello World!'
    });
}
} ,2000);*/

/*
 * declare map as a global variable
 */
var map;

/*
 * use google maps api built-in mechanism to attach dom events
 */
google.maps.event.addDomListener(window, "load", function () {

  /*
   * create map
   */
  var map = new google.maps.Map(document.getElementById("map_div"), {
    center: new google.maps.LatLng(Number(localStorage.getItem('adlat')), Number(localStorage.getItem('adlng'))),
    zoom: 14,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });

  /*
   * create infowindow (which will be used by markers)
   */
  var infoWindow = new google.maps.InfoWindow();

  /*
   * marker creater function (acts as a closure for html parameter)
   */
  function createMarker(options, html) {
    var marker = new google.maps.Marker(options);
    if (html) {
      google.maps.event.addListener(marker, "click", function () {
        infoWindow.setContent(html);
        infoWindow.open(options.map, this);
      });
    }
    return marker;
  }

  /*
   * add markers to map
   */
  var marker0 = createMarker({
    position: new google.maps.LatLng(Number(localStorage.getItem('adlat')), Number(localStorage.getItem('adlng'))),
    map: map,
    icon: "http://1.bp.blogspot.com/_GZzKwf6g1o8/S6xwK6CSghI/AAAAAAAAA98/_iA3r4Ehclk/s1600/marker-green.png"
  });
});


</script>

</body>

</html>
